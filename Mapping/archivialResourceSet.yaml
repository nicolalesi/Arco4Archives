prefixes:
    l0: "https://w3id.org/italia/onto/l0/"
    cov: "https://w3id.org/italia/onto/COV/"
    clv: "https://w3id.org/italia/onto/CLV/"
    prj: "https://w3id.org/italia/onto/Project/"
    rdfs: "http://www.w3.org/2000/01/rdf-schema#"
    xsd: "http://www.w3.org/2000/01/XMLSchema#"
    Arco4Archive: "https://w3id.org/italia/cultural-heritage/archives/onto/"
    data: "https://w3id.org/italia/cultural-heritage/archives/data/"
    ti: "https://schema.gov.it/lodview/onto/TI/"
    grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"
    arco-lite: "https://w3id.org/arco/ontology/arco-lite/"
    fno: "https://w3id.org/imec/idlab/function#"
    core: "https://w3id.org/arco/ontology/core/"
    a-cd: "https://w3id.org/arco/ontology/denotative-description/"  #Controllare
    idlab-fn: "https://w3id.org/imec/idlab/function#"

sources:
  data1:
    access: ComplArch.xml
    referenceFormulation: xpath
    iterator: "/ead/archdesc"
  data2:
    access: ComplArch.xml
    referenceFormulation: xpath
    iterator: "//physdescstructured"
  data3:
    access: ComplArch.xml
    referenceFormulation: xpath
    iterator: "/arrangement"
  data4:
    access: ComplArch.xml
    referenceFormulation: xpath
    iterator: "//arrangement/list"

mappings:
    ArchivialResourceSet:
        sources: 
        - data1
        - data2
        s: https://w3id.org/italia/cultural-heritage/archives/data/archivial-resource-set/$(did/unitid[1])
        po:
        - [a, Arco4Archive:ArchivialResourceSet]
        - [Arco4Archive:hasArchivialReferenceCode, "https://w3id.org/italia/cultural-heritage/archives/data/archivial-reference-code/$(did/unitid[1])~iri"]
        - [core:hasType, "https://w3id.org/arco/ontology/core/SystemIdentifier~iri"] # qui bisognerebbe fare string matching con le label un'altra source che sarebbe ArchivalHierarchy.ttl di Giorgia. Con yaml questa cosa non funziona molto bene, da capire, ma comunque l'oggetto dovrebbe essere questo per questa singola risorsa <https://w3id.org/italia/republic-history/data/arc-resource-type/fonds>
        - [arco-lite:alternativeIdentifier, "$(did/unitid[@localType='altroId'])"]
        - [arco-lite:alternativeIdentifier, "$(did/unitid[@localType='idPrecedente'])"] 
        - p: arco-lite:currentDesignation
          o:
              function: fno:concat
              parameters:
                - [fno:str,"https://w3id.org/italia/cultural-heritage/archives/data/alternative-designation/"]
                - parameter: fno:otherStr
                  value:
                    function: fno:slugify                                                                                             #aggiunto slugify
                    parameters:                                                                                                   
                    - [fno:str, "$(did/unittitle[1])"]
              type: iri
        - [arco-lite:alternativeDesignation, "$(did/unittitle[@label='altraDenominazione'])"]
        - [a-cd:hasDesignationInTime, "$(did/unittitle[@label='altraDenominazione'])"]
        - [Arco4Archive:unitOtherNameDateRange, "$(did/unittitle/date)"] # questo dato si mette nella a-cd:DesignationInTime della riga sopra, attaccandolo con la proprietà ti:atTime con oggetto https://w3id.org/italia/cultural-heritage/archives/data/time-interval/$(did/unittitle/date) ovviamente anche in questo caso la data deve essere passata nello slugify
        - [Arco4Archive:dateRangeInString, "$(did/unitdate)"] #questo non ce l'abbiamo nell'ontologia (la stringa per la data di un'ArchivalResource), mappiamo con il po di sotto
        - [ti:atTime, "https://w3id.org/italia/cultural-heritage/archives/data/time-interval/$(did/unitdatestructured/daterange/fromdate)-$(did/unitdatestructured/daterange/todate)~iri"]
        - [Arco4Archive:totalExtentInLinearMeters, "$(did/physdesc)",xsd:string]
        - [a-cd:hasConservationStatus, "https://w3id.org/arco/ontology/denotative-description/ConservationStatus/$(did/unitid[1])~iri"]
        - p: ti:hasTemporalEntity
          o:
                function: fno:concat
                parameters: 
                - [fno:str, https://w3id.org/italia/cultural-heritage/archives/data/temporal-entity/$(did/unitdatestructured/daterange/fromdate)]
                - [fno:delimiter, "-"]
                - [fno:otherStr, $(did/unitdatestructured/daterange/todate)]
                type: iri
        - p: Arco4Archive:hasExtent
          o:
                function: grel:array_join
                parameters: 
                - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/extent/"]
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(did/unitid[1])"]  #si sovrascivono --> io metterei la formazione dell'URI con sia tipo che quantità perchè venga formato così: https://w3id.org/italia/cultural-heritage/archives/data/extent/ + md5 di unitid + unittype + quantity, così non dovrebbe sovrascrivere...
                - parameter: grel:p_array_a                     #Sembra sovrascrivere anche in questo modo, viene fuori soltanto un'estensione, non vengono tirate fuori entrambe come sotto
                  value:                                        #Ricorda di cambiare anche URI di extension quando troviamo una soluzione
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(did/physdescset/physdescstructured/unittype)"] 
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(did/physdescset/physdescstructured/quantity)"] 
                type: iri
        - [core:description, "$(scopecontent/p)"]
        - [a-cd:historicalInformation, "$(custodhist/p)"]
        - p: Arco4Archive:hasArrangement                        #anche qui si sovrascrive, ho provato con concat ma è la stessa cosa 
          o: 
                function: grel:array_join
                parameters: 
                - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/arrangement/"]
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(did/unitid[1])"]      
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(arrangement/p/num)"]    
                - parameter: grel:p_array_a
                  value: 
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(arrangement/list/item)"]  
                type: iri



    TimeInterval:
        sources:
        - [ComplArch.xml~xpath, /ead/archdesc]
        s: https://w3id.org/italia/cultural-heritage/archives/data/archivial-resource-set/$(did/unitdatestructured/daterange/fromdate)-$(did/unitdatestructured/daterange/todate)
        po:
        - [a, ti:TimeInterval]
        - [ti:hasTimeInstantInside,"https://w3id.org/italia/cultural-heritage/archives/data/time-instant/$(did/unitdatestructured/daterange/fromdate)"] #occhio che pure i time instant solo degli URI di tipo ti:TimeInstant (come hai scritto nel mapping sotto)
        - [ti:hasTimeInstantInside,"https://w3id.org/italia/cultural-heritage/archives/data/time-instant/$(did/unitdatestructured/daterange/todate)"] #aggiungi https://w3id.org/italia/cultural-heritage/archives/data/time-instant/

    TimeInstantS:
        sources:
        - [ComplArch.xml~xpath, /ead/archdesc]
        s: https://w3id.org/italia/cultural-heritage/archives/data/time-instant/$(did/unitdatestructured/daterange/fromdate)
        po:
        - [a, ti:TimeInstant]
        - [core:note,"$(did/didnote[@label='Note_a_Estremo_recente_Complesso'])"]
        - [Arco4Archive:inIntervalPosition,"start"]

    TimeInstantE:
        sources:
        - [ComplArch.xml~xpath, /ead/archdesc]
        s: https://w3id.org/italia/cultural-heritage/archives/data/time-instant/$(did/unitdatestructured/daterange/todate)
        po:
        - [a, ti:TimeInstant]
        - [core:note,"$(did/didnote[@label='Note_a_Estremo_remoto_Complesso'])"] #immaginario
        - [Arco4Archive:inIntervalPosition,"end"]

    Extent:
        sources:
        - data2
        s: 
                function: grel:array_join
                parameters: 
                - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/extent/"]
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(.)"]       
        po: 
        - [a, Arco4Archive:Extent]
        - [Arco4Archive:quantity, $(quantity),xsd:integer]                                                          #ci sarà da controllare se sono scritti correttamente
        - [core:note, $(descriptivenote/p),xsd:string]
        - p: core:specification
          o:
            function: fno:concat
            parameters:
            - [fno:str,$(dimensions/@unit)]
            - [fno:delimiter, " "]
            - [fno:otherStr,$(dimensions)]
        - p: core:hasType
          o: 
            function: fno:concat
            parameters:
            - [fno:str,https://w3id.org/italia/cultural-heritage/archives/data/extent/extent-type/] # questo sarebbe da collegare al tuo archival-consistency-type vocabolario... magari lo guardiamo insieme
            - parameter : fno:otherStr
              value:
                function: grel:toLowerCase
                parameters:
                - [grel:valueParameter,$(unittype)]
            type: iri
    
    ConservationStatus:
      sources:
      - data1
      s: "https://w3id.org/arco/ontology/denotative-description/ConservationStatus/$(did/unitid[1])"
      po:
      - [a, a-cd:ConservationStatus]
      - [core:specification,"$(did/didnote[@localtype='Restauro_o_Altri_interventi']/p)"]       #potrebbe anche essere ConservationInterention?
      - [Arco4Archive:materialCondition,"$(did/didnote[@localtype='Condizioni_del_materiale']/p)"]
      - [core:hasType,"https://dati.beniculturali.it/lodview-arco-onto/ontology/core/hasType/$(did/didnote[@localtype='Stato_di_conservazione']/p)~iri"] #dobbiamo istanziare anche ConservationStatusType?
      - p: rdfs:label
        o:
          function: fno:concat
          parameters:
          - [fno:str , "Stato di conservazione 1 del bene: "]
          - [fno:otherStr , "$(did/unitid[1])"]

    Arrangement:
      sources:
      - data1
      s: 
                function: grel:array_join
                parameters: 
                - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/arrangement/"]
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(did/unitid[1])"]      
                - parameter: grel:p_array_a
                  value:
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(arrangement/p/num)"]   
                - parameter: grel:p_array_a
                  value: 
                    function: grel:string_md5
                    parameters: 
                    - [grel:valueParameter,"$(arrangement/list/item)"]   

      po: 
      - [a, Arco4Archive:Arrangement]
      - [core:description,"$(arrangement[1]/p)"]
      - p: Arco4Archive:hasNumbering
        o: 
          function: grel:array_join
          parameters:
          - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/arrangement/numbering/"]
          - parameter: grel:p_array_a
            value:
              function: grel:string_md5
              parameters:
              - [grel:valueParameter,"$(did/unitid[1])"]  
          - parameter: grel:p_array_a
            value:
              function: grel:string_md5
              parameters:
              - [grel:valueParameter,"$(arrangement/p/num)"]
          type: iri

    Numbering:
      sources: 
      - data1
      s:     
          function: grel:array_join
          parameters:
          - [grel:p_array_a,"https://w3id.org/italia/cultural-heritage/archives/data/arrangement/numbering/"]
          - parameter: grel:p_array_a
            value:
              function: grel:string_md5
              parameters:
              - [grel:valueParameter,"$(did/unitid[1])"]  
          - parameter: grel:p_array_a
            value:
              function: grel:string_md5
              parameters:
              - [grel:valueParameter,"$(arrangement/p/num)"]
      po: 
      - [a, Arco4Archive:Numbering]  
      - [core:description, $(arrangement/list/item)]      
      - p: Arco4Archive:hasNumberingType
        o: "https://w3id.org/italia/cultural-heritage/archives/data/arrangement/numbering/arabic-numeral~iri"
        condition:
                function: idlab-fn:equal
                parameters:
                - [grel:valueParameter,$(arrangement/p/num)]
                - [grel:valueParameter2,"numeri arabi"]
      - p: Arco4Archive:hasNumberingType
        o: "https://w3id.org/italia/cultural-heritage/archives/data/arrangement/numbering/roman-numeral~iri"
        condition:
                function: idlab-fn:equal
                parameters:
                - [grel:valueParameter,$(arrangement/p/num)]
                - [grel:valueParameter2,"numeri romani"]                                                #diciture supposte nei futuri dati
      - p: Arco4Archive:hasNumberingType
        o: "https://w3id.org/italia/cultural-heritage/archives/data/arrangement/numbering/alphanumerical~iri"
        condition:
                function: idlab-fn:equal
                parameters:
                - [grel:valueParameter,$(arrangement/p/num)]
                - [grel:valueParameter2,"numeri alfanumerici"]                              #Dobbiamo istanziare anche la classe numberginType?

#Guarda procedure di scarto su dati
#Guarda anche quello dopo

#Problema identificativo originali

    
